<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta http-equiv="Pragma" content="no-cache"/>
    <meta http-equiv="Expires" content="0"/>

    <title>Calculadora M√°gica</title>

    <!-- Librer√≠as JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <!-- Sistema de Login/Registro -->
    <div id="authContainer" class="auth-container" style="display: none;">
        <div class="auth-form">
            <h2>Calculadora M√°gica</h2>
            <div id="loginForm">
                <h3>Iniciar Sesi√≥n</h3>
                <input type="email" id="loginEmail" placeholder="Correo electr√≥nico" />
                <div class="password-container">
                    <input type="password" id="loginPassword" placeholder="Contrase√±a" />
                    <span class="toggle-password" onclick="togglePassword('loginPassword')">üëÅÔ∏è</span>
                </div>
                <button onclick="loginUser()" class="main-button">Ingresar</button>
                <p>¬øNo tienes cuenta? <a href="#" onclick="showRegisterForm()">Reg√≠strate aqu√≠</a></p>
            </div>
            <div id="registerForm" style="display: none;">
                <h3>Crear Cuenta</h3>
                <input type="text" id="registerName" placeholder="Nombre completo" />
                <input type="email" id="registerEmail" placeholder="Correo electr√≥nico" />
                <div class="password-container">
                    <input type="password" id="registerPassword" placeholder="Contrase√±a" />
                    <span class="toggle-password" onclick="togglePassword('registerPassword')">üëÅÔ∏è</span>
                </div>
                <button onclick="registerUser()" class="main-button">Registrarse</button>
                <p>¬øYa tienes cuenta? <a href="#" onclick="showLoginForm()">Inicia sesi√≥n aqu√≠</a></p>
            </div>
        </div>
    </div>

    <!-- Panel Administrativo -->
    <div id="adminPanel" class="admin-panel" style="display: none;">
        <div class="admin-header">
            <h2>Panel Administrativo</h2>
            <button onclick="logout()" class="logout-btn-admin">Cerrar Sesi√≥n</button>
        </div>
        
        <div class="admin-content">
            <h3>Gesti√≥n de Usuarios</h3>
            <div class="users-list">
                <table>
                    <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Correo</th>
                            <th>Plan</th>
                            <th>Productos</th>
                            <th>Dispositivos</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Aplicaci√≥n Principal -->
    <div id="mainApp" style="display: none;">
        <div class="user-header">
            <div class="user-info">
                <span id="userWelcome">Bienvenido</span>
                <span id="userPlan" class="plan-badge">FREE</span>
                <span id="productCount" class="product-counter">Productos: 0/3</span>
            </div>
            <button onclick="logout()" class="logout-btn">Cerrar Sesi√≥n</button>
        </div>

        <div class="copyright-icon" onclick="toggleCopyrightNotice()">¬©</div>

        <div class="copyright-notice" id="copyrightNotice">
            <button class="close-btn" onclick="toggleCopyrightNotice()">√ó</button>
            <strong>ADVERTENCIA:</strong> Este sistema est√° protegido por derechos de autor.
            <strong>No revendas tu c√≥digo de acceso</strong> o ser√° bloqueado y perder√°s tu dinero.
            Cualquier uso no autorizado ser√° penalizado seg√∫n las leyes aplicables.
        </div>

        <div class="calculator">
            <h2>Calculadora M√°gica</h2>

            <!-- Secci√≥n para respaldo/restauraci√≥n de datos -->
            <section>
                <h3>Respaldo y Restauraci√≥n de Datos</h3>
                <button onclick="descargarBackup()" class="backup-button">Descargar Respaldo</button>
                <button onclick="document.getElementById('fileInput').click()" class="restore-button">Cargar Respaldo</button>
                <input type="file" id="fileInput" accept=".json" style="display: none" onchange="cargarBackup(this.files)" />
            </section>

            <section>
                <h3>Nombre del Establecimiento</h3>
                <input type="text" id="nombreEstablecimiento" placeholder="Ej: Tienda La Bendici√≥n" />
                <button onclick="guardarNombreEstablecimiento()">Guardar Nombre</button>
            </section>

            <section>
                <h3>Tasa BCV</h3>
                <input type="number" id="tasaBCV" placeholder="Tasa BCV" required />
                <button onclick="actualizarTasaBCV()">Actualizar Tasa BCV</button>
            </section>

            <section>
                <h3>Datos del Producto</h3>
                <input type="text" id="producto" placeholder="Nombre del producto" required />
                <input type="text" id="codigoBarras" placeholder="C√≥digo de barras (opcional)" />
                <input type="number" id="costo" placeholder="Costo del producto (en $)" required />
                <select id="descripcion" required>
                    <option value="">Selecciona una descripci√≥n</option>
                    <option value="viveres">V√≠veres</option>
                    <option value="bebidas">Bebidas</option>
                    <option value="licores">Licores</option>
                    <option value="enlatados">Enlatados</option>
                    <option value="plasticos">Pl√°sticos</option>
                    <option value="papeleria">Papeler√≠a</option>
                    <option value="lacteos">L√°cteos</option>
                    <option value="ferreteria">Ferreter√≠a</option>
                    <option value="agropecuaria">Agropecuaria</option>
                    <option value="frigorifico">Frigor√≠fico</option>
                    <option value="pescaderia">Pescader√≠a</option>
                    <option value="repuesto">Repuesto</option>
                    <option value="confiteria">Confiter√≠a</option>
                    <option value="ropa">Ropa</option>
                    <option value="calzados">Calzados</option>
                    <option value="charcuteria">Charcuter√≠a</option>
                    <option value="carnes">Carnes</option>
                    <option value="aseo_personal">Aseo Personal</option>
                    <option value="limpieza">Productos de Limpieza</option>
                    <option value="verduras">VERDURAS</option>
                    <option value="frutas">FRUTAS</option>
                    <option value="hortalizas">HORTALIZAS</option>
                    <option value="ali√±os">ALI√ëOS</option>
                    <option value="otros">OTROS</option>
                </select>
            </section>

            <section>
                <h3>Precio de Venta</h3>
                <input type="number" id="ganancia" placeholder="Porcentaje de ganancia" required />
                <input type="number" id="unidadesPorCaja" placeholder="Unidades que trae la caja (ej: 1 para Queso en kg)" required />
                <input type="number" id="unidadesExistentes" placeholder="Unidades existentes (ej: 50 si tienes 50 kg)" required />
                <button onclick="calcularPrecioVenta()">Calcular Precio de Venta</button>
                <p id="precioUnitario">Precio unitario: </p>
            </section>

            <button onclick="guardarProducto()" id="guardarProductoBtn">Guardar Producto</button>
            <div id="productLimitMessage" class="limit-message" style="display: none;"></div>
        </div>

        <div id="listaProductos">
            <input type="text" id="buscar" placeholder="Buscar producto" />
            <button onclick="buscarProducto()">Buscar</button>

            <table>
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Descripci√≥n</th>
                        <th>C√≥digo Barras</th>
                        <th>Existencias</th>
                        <th>Ajustar Inventario</th>
                        <th>Precio Unitario ($)</th>
                        <th>Precio Unitario (Bs)</th>
                        <th>Ganancia (%)</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>

            <div class="action-buttons">
                <button onclick="generarReporteDiario()" class="generar-pdf">Generar Reporte Diario</button>
                <button onclick="mostrarListaCostos()" class="lista-costos">Mostrar Lista de Costos</button>
                <button onclick="mostrarOpcionesPDF()" class="generar-pdf-categoria">PDF POR CATEGOR√çA</button>
                <button onclick="generarEtiquetasAnaqueles()" class="generar-etiquetas">ETIQUETAS ANAQUELES</button>
            </div>

            <div id="listaCostosContainer" style="display: none;">
                <div class="costos-header">
                    <h3>Lista de Costos de Productos</h3>
                    <div>
                        <input type="text" id="buscarCostos" placeholder="Buscar en lista de costos" style="display:none" oninput="filtrarListaCostos()" />
                        <button onclick="generarPDFCostos()" class="generar-pdf-costos">Convertir a PDF</button>
                    </div>
                </div>
                <ul id="listaCostos"></ul>
            </div>
        </div>

        <!-- Modal para selecci√≥n de categor√≠as PDF -->
        <div id="modalCategorias" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="cerrarModalCategorias()">&times;</span>
                <h3>Generar PDF por Categor√≠a</h3>
                <div class="categorias-lista">
                    <button onclick="generarPDFPorCategoria('todos')" class="categoria-btn">TODOS LOS PRODUCTOS</button>
                    <button onclick="generarPDFPorCategoria('viveres')" class="categoria-btn">V√çVERES</button>
                    <button onclick="generarPDFPorCategoria('bebidas')" class="categoria-btn">BEBIDAS</button>
                    <button onclick="generarPDFPorCategoria('licores')" class="categoria-btn">LICORES</button>
                    <button onclick="generarPDFPorCategoria('enlatados')" class="categoria-btn">ENLATADOS</button>
                    <button onclick="generarPDFPorCategoria('plasticos')" class="categoria-btn">PL√ÅSTICOS</button>
                    <button onclick="generarPDFPorCategoria('papeleria')" class="categoria-btn">PAPELER√çA</button>
                    <button onclick="generarPDFPorCategoria('lacteos')" class="categoria-btn">L√ÅCTEOS</button>
                    <button onclick="generarPDFPorCategoria('ferreteria')" class="categoria-btn">FERRETER√çA</button>
                    <button onclick="generarPDFPorCategoria('agropecuaria')" class="categoria-btn">AGROPECUARIA</button>
                    <button onclick="generarPDFPorCategoria('frigorifico')" class="categoria-btn">FRIGOR√çFICO</button>
                    <button onclick="generarPDFPorCategoria('pescaderia')" class="categoria-btn">PESCADER√çA</button>
                    <button onclick="generarPDFPorCategoria('repuesto')" class="categoria-btn">REPUESTO</button>
                    <button onclick="generarPDFPorCategoria('confiteria')" class="categoria-btn">CONFITER√çA</button>
                    <button onclick="generarPDFPorCategoria('ropa')" class="categoria-btn">ROPA</button>
                    <button onclick="generarPDFPorCategoria('calzados')" class="categoria-btn">CALZADOS</button>
                    <button onclick="generarPDFPorCategoria('charcuteria')" class="categoria-btn">CHARCUTER√çA</button>
                    <button onclick="generarPDFPorCategoria('carnes')" class="categoria-btn">CARNES</button>
                    <button onclick="generarPDFPorCategoria('aseo_personal')" class="categoria-btn">ASEO PERSONAL</button>
                    <button onclick="generarPDFPorCategoria('limpieza')" class="categoria-btn">PRODUCTOS DE LIMPIEZA</button>
                    <button onclick="generarPDFPorCategoria('verduras')" class="categoria-btn">VERDURAS</button>
                    <button onclick="generarPDFPorCategoria('frutas')" class="categoria-btn">FRUTAS</button>
                    <button onclick="generarPDFPorCategoria('hortalizas')" class="categoria-btn">HORTALIZAS</button>
                    <button onclick="generarPDFPorCategoria('ali√±os')" class="categoria-btn">ALI√ëOS</button>
                    <button onclick="generarPDFPorCategoria('otros')" class="categoria-btn">OTROS</button>
                </div>
            </div>
        </div>

        <!-- Modal para selecci√≥n de categor√≠as etiquetas -->
        <div id="modalEtiquetas" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="cerrarModalEtiquetas()">&times;</span>
                <h3>Generar Etiquetas para Anaqueles</h3>
                <div class="categorias-lista">
                    <button onclick="generarEtiquetasPorCategoria('todos')" class="categoria-btn">TODOS LOS PRODUCTOS</button>
                    <button onclick="generarEtiquetasPorCategoria('viveres')" class="categoria-btn">V√çVERES</button>
                    <button onclick="generarEtiquetasPorCategoria('bebidas')" class="categoria-btn">BEBIDAS</button>
                    <button onclick="generarEtiquetasPorCategoria('licores')" class="categoria-btn">LICORES</button>
                    <button onclick="generarEtiquetasPorCategoria('enlatados')" class="categoria-btn">ENLATADOS</button>
                    <button onclick="generarEtiquetasPorCategoria('plasticos')" class="categoria-btn">PL√ÅSTICOS</button>
                    <button onclick="generarEtiquetasPorCategoria('papeleria')" class="categoria-btn">PAPELER√çA</button>
                    <button onclick="generarEtiquetasPorCategoria('lacteos')" class="categoria-btn">L√ÅCTEOS</button>
                    <button onclick="generarEtiquetasPorCategoria('ferreteria')" class="categoria-btn">FERRETER√çA</button>
                    <button onclick="generarEtiquetasPorCategoria('agropecuaria')" class="categoria-btn">AGROPECUARIA</button>
                    <button onclick="generarEtiquetasPorCategoria('frigorifico')" class="categoria-btn">FRIGOR√çFICO</button>
                    <button onclick="generarEtiquetasPorCategoria('pescaderia')" class="categoria-btn">PESCADER√çA</button>
                    <button onclick="generarEtiquetasPorCategoria('repuesto')" class="categoria-btn">REPUESTO</button>
                    <button onclick="generarEtiquetasPorCategoria('confiteria')" class="categoria-btn">CONFITER√çA</button>
                    <button onclick="generarEtiquetasPorCategoria('ropa')" class="categoria-btn">ROPA</button>
                    <button onclick="generarEtiquetasPorCategoria('calzados')" class="categoria-btn">CALZADOS</button>
                    <button onclick="generarEtiquetasPorCategoria('charcuteria')" class="categoria-btn">CHARCUTER√çA</button>
                    <button onclick="generarEtiquetasPorCategoria('carnes')" class="categoria-btn">CARNES</button>
                    <button onclick="generarEtiquetasPorCategoria('aseo_personal')" class="categoria-btn">ASEO PERSONAL</button>
                    <button onclick="generarEtiquetasPorCategoria('limpieza')" class="categoria-btn">PRODUCTOS DE LIMPIEZA</button>
                    <button onclick="generarEtiquetasPorCategoria('verduras')" class="categoria-btn">VERDURAS</button>
                    <button onclick="generarEtiquetasPorCategoria('frutas')" class="categoria-btn">FRUTAS</button>
                    <button onclick="generarEtiquetasPorCategoria('hortalizas')" class="categoria-btn">HORTALIZAS</button>
                    <button onclick="generarEtiquetasPorCategoria('ali√±os')" class="categoria-btn">ALI√ëOS</button>
                    <button onclick="generarEtiquetasPorCategoria('otros')" class="categoria-btn">OTROS</button>
                </div>
            </div>
        </div>

        <div class="carrito-ventas">
            <h2>Carrito de Ventas</h2>

            <div class="carrito-header">
                <div class="scanner-input">
                    <input type="text" id="codigoBarrasInput" placeholder="Escanea o ingresa c√≥digo de barras o nombre del producto" />
                    <button onclick="agregarPorCodigoBarras()">Agregar Producto</button>

                    <div id="sugerencias" class="sugerencias-lista" aria-live="polite"></div>
                </div>

                <div class="scanner-status" id="scannerStatus">
                    Esperando escaneo de c√≥digo de barras...
                </div>

                <div class="carrito-totales">
                    <div class="carrito-total" id="totalCarritoBs">
                        Total: Bs 0,00
                    </div>
                    <div class="carrito-total" id="totalCarritoDolares">
                        Total: $ 0,00
                    </div>
                </div>
            </div>

            <table class="carrito-table">
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Precio Unitario (Bs)</th>
                        <th>Cantidad</th>
                        <th>Unidad</th>
                        <th>Subtotal (Bs)</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="carritoBody"></tbody>
            </table>

            <div class="finalizar-venta">
               <button id="finalizarVenta" onclick="finalizarVenta()">Finalizar venta</button>
            </div>
        </div>

        <div id="modalPago" class="modal">
            <div class="modal-content">
                <span class="close" onclick="cerrarModalPago()">&times;</span>
                <h3>Seleccionar M√©todo de Pago</h3>

                <div class="resumen-venta">
                    <h4>Resumen de Venta</h4>
                    <p id="resumenTotalBs">Total: Bs 0,00</p>
                    <p id="resumenTotalDolares">Total: $ 0,00</p>
                </div>

                <div class="metodos-pago">
                    <button onclick="seleccionarMetodoPago('efectivo_bs')">Efectivo Bs</button>
                    <button onclick="seleccionarMetodoPago('efectivo_dolares')">Efectivo $</button>
                    <button onclick="seleccionarMetodoPago('punto')">Punto</button>
                    <button onclick="seleccionarMetodoPago('pago_movil')">Pago M√≥vil</button>
                    <button onclick="seleccionarMetodoPago('biopago')">Biopago</button>
                </div>

                <div id="detallesPago" style="display: none; margin-top: 20px;">
                    <h4>Detalles del Pago</h4>
                    <div id="camposPago"></div>
                    <div class="modal-buttons">
                        <button onclick="confirmarMetodoPago()">Confirmar Pago</button>
                        <button onclick="cancelarPago()" class="btn-cancelar">Cancelar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="floating-nav">
            <button class="go-top" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">‚Üë</button>
            <button class="go-bottom" onclick="window.scrollTo({top: document.body.scrollHeight, behavior: 'smooth'})">‚Üì</button>
        </div>

        <!-- Toast container -->
        <div id="toastContainer" aria-live="polite" aria-atomic="true"></div>
    </div>

    <script src="config.js"></script>
    <script src="script.js"></script>
</body>
</html>
